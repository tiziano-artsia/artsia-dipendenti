@import "tailwindcss";

@theme {
  --font-sans: system-ui, sans-serif;
}

/* ==================== Safe Area iOS ==================== */
.pb-safe {
  padding-bottom: env(safe-area-inset-bottom, 0px);
}

.pt-safe {
  padding-top: env(safe-area-inset-top, 0px);
}

/* Desktop: rimuovi padding safe area */
@media (min-width: 769px) {
  .pt-safe {
    padding-top: 0 !important;
  }
  .pb-safe {
    padding-bottom: 0 !important;
  }
}

/* ==================== Mobile Layout Fixes ==================== */

@media (max-width: 768px) {
  /* ✅ Header completamente opaco con blur forte */
  header {
    background: rgba(255, 255, 255, 1) !important; /* Opaco al 100% */
    backdrop-filter: blur(20px) saturate(180%) !important;
    -webkit-backdrop-filter: blur(20px) saturate(180%) !important;
    border-bottom: 1px solid rgba(229, 231, 235, 1) !important;
    box-shadow: 0 1px 3px rgba(0, 0, 0, 0.05) !important;
  }

  /* ✅ Bottom nav completamente opaco con blur forte */
  nav[class*="fixed bottom-0"] {
    background: rgba(255, 255, 255, 1) !important; /* Opaco al 100% */
    backdrop-filter: blur(20px) saturate(180%) !important;
    -webkit-backdrop-filter: blur(20px) saturate(180%) !important;
    border-top: 1px solid rgba(229, 231, 235, 1) !important;
    box-shadow: 0 -2px 10px rgba(0, 0, 0, 0.08) !important;
  }

  /* ✅ Previeni overflow del contenuto sotto header */
  body {
    padding-top: 0 !important;
  }

  /* ✅ Main con padding corretto per header + bottom nav */
  main {
    /* Spazio per header (safe-area + altezza header) */
    padding-top: calc(env(safe-area-inset-top, 0px) + 3.5rem) !important;
    /* Spazio per bottom nav (altezza nav + safe-area) */
    padding-bottom: calc(5.5rem + env(safe-area-inset-bottom, 0px)) !important;
    min-height: 100vh;
  }

  /* ✅ Header con posizione sticky + z-index alto */
  header {
    position: sticky !important;
    top: 0 !important;
    z-index: 100 !important;
    width: 100% !important;
  }

  /* ✅ Bottom nav con z-index alto */
  nav[class*="fixed bottom-0"] {
    z-index: 100 !important;
  }
}

/* ==================== iOS Gestures ==================== */

@supports (-webkit-touch-callout: none) {
  html, body {
    overscroll-behavior-x: auto !important;
    -webkit-overflow-scrolling: touch !important;
  }

  body {
    touch-action: pan-x pan-y !important;
  }

  * {
    -webkit-touch-callout: default;
    -webkit-user-select: auto;
    user-select: auto;
  }

  button,
  a,
  [role="button"],
  input,
  select,
  textarea,
  [onclick] {
    -webkit-touch-callout: none !important;
    -webkit-user-select: none !important;
    user-select: none !important;
  }
}

/* ==================== iOS Specific Fixes ==================== */

@supports (-webkit-touch-callout: none) {
  @media (max-width: 768px) {
    /* ✅ Previeni scroll sotto Dynamic Island */
    body {
      scroll-padding-top: calc(env(safe-area-inset-top, 0px) + 3.5rem);
    }

    /* ✅ Forza background solido su iOS */
    header::before {
      content: '';
      position: absolute;
      inset: 0;
      background: white;
      z-index: -1;
    }

    nav[class*="fixed bottom-0"]::before {
      content: '';
      position: absolute;
      inset: 0;
      background: white;
      z-index: -1;
    }

    /* ✅ Estendi background header fino a Dynamic Island */
    header {
      padding-top: env(safe-area-inset-top, 0px) !important;
      margin-top: calc(-1 * env(safe-area-inset-top, 0px)) !important;
    }

    /* ✅ Estendi background bottom nav fino a home indicator */
    nav[class*="fixed bottom-0"] {
      padding-bottom: env(safe-area-inset-bottom, 0px) !important;
    }
  }
}

/* ==================== Dropdown Notifiche Mobile ==================== */

@media (max-width: 768px) {
  /* Dropdown sopra tutto */
  [class*="fixed"][class*="bottom-24"] {
    z-index: 110 !important;
  }

  /* Overlay backdrop */
  [class*="fixed inset-0"][class*="bg-black"] {
    z-index: 105 !important;
  }
}
